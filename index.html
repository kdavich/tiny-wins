<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Routine</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --bg: #F0F4F8;
            --card-bg: #FFFFFF;
            --evening-bg: #2C3E50;
            --evening-text: #ECF0F1;
            --danger: #ff4757;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            /* Remove padding from body so header sits flush at top */
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
            transition: background-color 0.5s;
        }

        body.evening-mode {
            background-color: var(--evening-bg);
            color: var(--evening-text);
        }
        
        body.evening-mode h1 { color: var(--evening-text); }

        /* NEW TOP HEADER LAYOUT */
        header {
            display: flex;
            justify-content: space-between; /* Push items to edges */
            align-items: center;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1); /* Subtle transparency */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .mode-switch {
            background: rgba(255,255,255,0.5);
            border-radius: 30px;
            padding: 4px;
            display: flex;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .mode-btn {
            font-size: 1.5rem;
            padding: 2px 12px;
            cursor: pointer;
            border-radius: 25px;
            background: transparent;
            border: none;
            opacity: 0.5;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            opacity: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transform: scale(1.1);
        }

        /* TOP RIGHT CONTROLS */
        .top-controls {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }

        .icon-btn:active { transform: scale(0.9); }
        .reset-btn { color: var(--danger); }

        /* TITLE */
        h1 {
            text-align: center;
            color: #333;
            margin: 10px 0 10px 0;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        /* GRID */
        #routine-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            /* Extra padding at bottom so banner doesn't cover tasks */
            padding-bottom: 80px; 
        }

        .task-card {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
            cursor: pointer;
            transition: transform 0.2s;
            border: 4px solid transparent;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            color: #333;
        }

        .task-card:active { transform: scale(0.95); }

        .task-emoji { font-size: 4rem; margin-bottom: 10px; }
        .task-label { font-size: 1.2rem; font-weight: bold; color: #555; text-align: center; }

        .task-card.done {
            background-color: #E8F8F5;
            border-color: var(--success);
            opacity: 0.6;
        }

        .task-card.done .task-emoji::after {
            content: '‚úÖ';
            position: absolute;
            font-size: 3rem;
            transform: translate(-50%, -50%);
            left: 50%; top: 50%;
        }
        
        .task-card.done .task-emoji { opacity: 0.3; }


        /* SETTINGS MODAL */
        #settings-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 200;
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
            color: #333;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            flex-shrink: 0;
        }

        #settings-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 50px;
        }

        .task-editor-row {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            gap: 10px;
        }

        /* Checkbox */
        .task-editor-row input[type="checkbox"] {
            transform: scale(1.5);
            margin: 0 10px;
        }

        /* Inputs */
        .edit-emoji {
            width: 40px;
            font-size: 1.5rem;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }
        
        .edit-label {
            flex-grow: 1;
            font-size: 1rem;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .delete-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #ccc;
            padding: 0 10px;
        }
        .delete-btn:hover { color: var(--danger); }

        .add-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-top: 20px;
            cursor: pointer;
        }
        
        button.control-btn {
            background: #eee; border: none; padding: 10px 20px; border-radius: 10px; font-size: 1rem; color: #555;
        }

        /* CELEBRATION */
        #celebration {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 300;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }
        
        #celebration h1 { color: white; font-size: 3rem; margin: 20px 0; }
        .big-star { font-size: 8rem; animation: spin 3s infinite linear; }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }

        #confetti-canvas {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 301;
        }
    </style>
</head>
<body>

    <header>
        <div class="mode-switch">
            <button class="mode-btn active" id="btn-morning" onclick="setMode('morning')">‚òÄÔ∏è</button>
            <button class="mode-btn" id="btn-evening" onclick="setMode('evening')">üåô</button>
        </div>

        <div class="top-controls">
            <button class="icon-btn" onclick="openSettings()" aria-label="Settings">‚öôÔ∏è</button>
            <button class="icon-btn reset-btn" onclick="resetRoutine()" aria-label="Reset">üîÑ</button>
        </div>
    </header>

    <h1 id="page-title">Good Morning!</h1>

    <div id="routine-grid"></div>

    <div id="settings-modal" style="display:none;">
        <div class="settings-header">
            <h2 id="settings-title">Edit Morning Tasks</h2>
            <button class="control-btn" onclick="closeSettings()">Done</button>
        </div>
        <div style="margin-bottom:10px; color:#666; font-size:0.9rem;">
            Check to Show. Edit text/emoji to customize.
        </div>
        <div id="settings-content">
            <div id="settings-list"></div>
            <button class="add-btn" onclick="addNewTask()">+ Add New Task</button>
        </div>
    </div>

    <div id="celebration" onclick="closeCelebration()">
        <div class="big-star">‚≠ê</div>
        <h1>YOU DID IT!</h1>
        <p>(Tap to close)</p>
    </div>
    <canvas id="confetti-canvas"></canvas>

<script>
    // --- DATA MANAGEMENT ---
    
    // Default Tasks
    const defaults = [
        { id: 'potty', label: 'Potty', emoji: 'üöΩ' },
        { id: 'hands', label: 'Wash Hands', emoji: 'üßº' },
        { id: 'breakfast', label: 'Eat Breakfast', emoji: 'ü•û' },
        { id: 'dinner', label: 'Eat Dinner', emoji: 'üçΩÔ∏è' },
        { id: 'bath', label: 'Bath Time', emoji: 'üõÅ' },
        { id: 'pjs', label: 'Pajamas', emoji: 'üëï' },
        { id: 'dressed', label: 'Get Dressed', emoji: 'üëï' },
        { id: 'teeth', label: 'Brush Teeth', emoji: 'ü™•' },
        { id: 'book', label: 'Read Book', emoji: 'üìö' },
        { id: 'toys', label: 'Clean Toys', emoji: 'üß∏' },
        { id: 'bed', label: 'Bedtime', emoji: 'üõèÔ∏è' },
        { id: 'shoes', label: 'Put on Shoes', emoji: 'üëü' },
        { id: 'coat', label: 'Wear Coat', emoji: 'üß•' },
        { id: 'car', label: 'Get in Car', emoji: 'üöó' },
        { id: 'water', label: 'Drink Water', emoji: 'üíß' },
        { id: 'nap', label: 'Nap Time', emoji: 'üò¥' },
        { id: 'pack', label: 'Pack Bag', emoji: 'üéí' }
    ];

    let allTasks = JSON.parse(localStorage.getItem('myRoutineAllTasks')) || defaults;

    let taskLists = JSON.parse(localStorage.getItem('myRoutineLists')) || {
        morning: ['potty', 'breakfast', 'dressed', 'teeth', 'shoes'],
        evening: ['dinner', 'bath', 'pjs', 'teeth', 'book', 'bed']
    };
    
    let completedState = JSON.parse(localStorage.getItem('myRoutineState')) || {
        morning: [],
        evening: []
    };

    let currentMode = 'morning';

    const grid = document.getElementById('routine-grid');
    const settingsList = document.getElementById('settings-list');
    const celebrationModal = document.getElementById('celebration');
    const pageTitle = document.getElementById('page-title');

    function init() {
        setMode('morning');
    }

    function saveAll() {
        localStorage.setItem('myRoutineAllTasks', JSON.stringify(allTasks));
        localStorage.setItem('myRoutineLists', JSON.stringify(taskLists));
        localStorage.setItem('myRoutineState', JSON.stringify(completedState));
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('btn-morning').classList.toggle('active', mode === 'morning');
        document.getElementById('btn-evening').classList.toggle('active', mode === 'evening');
        document.body.classList.toggle('evening-mode', mode === 'evening');
        pageTitle.innerText = mode === 'morning' ? "Good Morning!" : "Good Night!";
        renderGrid();
    }

    function renderGrid() {
        grid.innerHTML = '';
        const activeIDs = taskLists[currentMode];
        const doneIDs = completedState[currentMode];
        const validIDs = activeIDs.filter(id => allTasks.find(t => t.id === id));
        
        if (validIDs.length === 0) {
            grid.innerHTML = '<p style="text-align:center; width:100%; color:#999; margin-top:20px;">No tasks set for this time. Tap ‚öôÔ∏è to add some!</p>';
            return;
        }

        validIDs.forEach(id => {
            const task = allTasks.find(t => t.id === id);
            const card = document.createElement('div');
            card.className = `task-card ${doneIDs.includes(id) ? 'done' : ''}`;
            card.onclick = () => toggleTask(id);
            card.innerHTML = `
                <div class="task-emoji">${task.emoji}</div>
                <div class="task-label">${task.label}</div>
            `;
            grid.appendChild(card);
        });
    }

    function toggleTask(id) {
        let doneTasks = completedState[currentMode];
        if (doneTasks.includes(id)) {
            doneTasks = doneTasks.filter(t => t !== id);
        } else {
            doneTasks.push(id);
            if (isAllDone(doneTasks)) setTimeout(triggerCelebration, 500);
        }
        completedState[currentMode] = doneTasks;
        saveAll();
        renderGrid();
    }

    function isAllDone(doneList) {
        const required = taskLists[currentMode].filter(id => allTasks.find(t => t.id === id));
        return required.length > 0 && required.every(id => doneList.includes(id));
    }

    function resetRoutine() {
        if(confirm("Start " + currentMode + " over?")) {
            completedState[currentMode] = [];
            saveAll();
            renderGrid();
        }
    }

    function triggerCelebration() {
        celebrationModal.style.display = 'flex';
        startConfetti();
    }

    function closeCelebration() {
        celebrationModal.style.display = 'none';
        stopConfetti();
    }

    function openSettings() {
        document.getElementById('settings-modal').style.display = 'flex';
        document.getElementById('settings-title').innerText = currentMode === 'morning' ? "Edit Morning Tasks" : "Edit Evening Tasks";
        renderSettingsList();
    }

    function closeSettings() {
        document.getElementById('settings-modal').style.display = 'none';
        renderGrid();
    }

    function renderSettingsList() {
        settingsList.innerHTML = '';
        const activeIDs = taskLists[currentMode];

        allTasks.forEach(task => {
            const row = document.createElement('div');
            row.className = 'task-editor-row';
            
            const isChecked = activeIDs.includes(task.id);
            
            row.innerHTML = `
                <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleSettingSelection('${task.id}')">
                <input type="text" class="edit-emoji" value="${task.emoji}" onchange="updateTaskProp('${task.id}', 'emoji', this.value)">
                <input type="text" class="edit-label" value="${task.label}" onchange="updateTaskProp('${task.id}', 'label', this.value)">
                <button class="delete-btn" onclick="deleteTask('${task.id}')">üóëÔ∏è</button>
            `;
            settingsList.appendChild(row);
        });
    }

    function toggleSettingSelection(id) {
        let list = taskLists[currentMode];
        if (list.includes(id)) {
            list = list.filter(t => t !== id);
        } else {
            list.push(id);
        }
        taskLists[currentMode] = list;
        saveAll();
    }

    function updateTaskProp(id, prop, value) {
        const task = allTasks.find(t => t.id === id);
        if (task) {
            task[prop] = value;
            saveAll();
        }
    }

    function addNewTask() {
        const newId = 'task_' + Date.now();
        const newTask = { id: newId, label: 'New Task', emoji: '‚≠ê' };
        allTasks.push(newTask);
        taskLists[currentMode].push(newId);
        saveAll();
        renderSettingsList();
    }

    function deleteTask(id) {
        if(confirm("Delete this task permanently?")) {
            allTasks = allTasks.filter(t => t.id !== id);
            taskLists.morning = taskLists.morning.filter(t => t !== id);
            taskLists.evening = taskLists.evening.filter(t => t !== id);
            saveAll();
            renderSettingsList();
        }
    }

    // --- CONFETTI ---
    let confettiActive = false;
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function startConfetti() { confettiActive = true; particles = []; animateConfetti(); }
    function stopConfetti() { confettiActive = false; ctx.clearRect(0, 0, canvas.width, canvas.height); }

    function createParticle() {
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
        return {
            x: Math.random() * canvas.width, y: -20,
            color: colors[Math.floor(Math.random() * colors.length)],
            size: Math.random() * 10 + 5,
            speedY: Math.random() * 3 + 2, speedX: Math.random() * 4 - 2,
            rotation: Math.random() * 360, rotationSpeed: Math.random() * 10 - 5
        };
    }

    function animateConfetti() {
        if (!confettiActive && particles.length === 0) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (confettiActive && particles.length < 150) particles.push(createParticle());
        particles.forEach((p, index) => {
            p.y += p.speedY; p.x += p.speedX; p.rotation += p.rotationSpeed;
            ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rotation * Math.PI / 180);
            ctx.fillStyle = p.color; ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
            ctx.restore();
            if (p.y > canvas.height) particles.splice(index, 1);
        });
        requestAnimationFrame(animateConfetti);
    }

    init();

</script>
</body>
</html>